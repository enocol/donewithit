{% extends 'base.html' %}
{% load static %}

{% block extracss %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock extracss %}

{% block content %}
<div class="container pt-5">

  <!-- Flash messages -->
  {% if messages %}
        <div class="row mb-4">
          <div class="col-12">
            {% for message in messages %}
              <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show shadow-sm rounded-3" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
        </div>
  {% endif %}

  <div class="row">
    <!-- Profile Info Card -->
        <div class="col-sm-12 col-md-4">
          <div class="card shadow-sm border-0 rounded-3 profile-card">
            <div class="card-body p-4">
              <h4 class="card-title mb-3">Account Information</h4>
              <hr>
                  <div class="mb-3">
                    {% if profile.profile_image %}
                      <img src="{{ profile.profile_image.url }}" alt="Profile Image" class="img-fluid rounded-circle profile-image">
                    {% else %}
                      <img src="{% static 'images/default_profile.png' %}" alt="Default Profile Image" class="img-fluid rounded-circle profile-image">
                    {% endif %}
                  </div>
                <div class="mb-3">
                  <h5 class="mt-2">{{ user.get_full_name|default:user.username }}</h5>
                  <p class="text-muted mb-1"><i class="fas fa-envelope me-2"></i>{{ user.email }}</p>
                  <p class="text-muted mb-1"><i class="fas fa-user me-2"></i>Username: {{ user.username }}</p>
                  <p class="text-muted mb-1"><i class="fas fa-calendar-alt me-2"></i>Member since: {{ user.date_joined|date:"F j, Y" }}</p>
                  <a href="{% url 'account_logout' %}" class="btn btn-outline-danger btn-sm mt-3">Logout</a>
                  <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary btn-sm mt-3">Edit Profile</a>
              </div>
          </div>
        </div>
      </div>

    <div class="col-sm-12 col-md-8">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body p-4">
          <h4 class="card-title mb-3">Manage Your Products</h4>
          <hr>

          {% if products %}
            <div class="table-responsive">
              <table class="table align-middle table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Image</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for product in products %}
                    <tr>
                      <td>
                        <a href="{% url 'product_detail' product.id %}" class="fw-semibold text-decoration-none">
                          {{ product.product_name }}
                        </a>
                      </td>
                      <td>Â£{{ product.price|floatformat:2 }}</td>
                      <td>
                        {% if product.main_image %}
                          <img src="{{ product.main_image.url }}" alt="{{ product.product_name }}" class="img-thumbnail" style="max-width:80px;">
                        {% else %}
                          <span class="text-muted">No image</span>
                        {% endif %}
                      </td>
                      <td>
                        {% if request.user == product.seller or request.user.is_superuser %}
                          <a href="{% url 'product_edit' product.id %}" class="btn btn-sm btn-outline-primary me-1">Edit</a>
                          <form action="{% url 'product_delete' product.id %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Delete this product?');">
                              Delete
                            </button>
                          </form>
                        {% else %}
                          <span class="badge bg-secondary">No actions</span>
                        {% endif %}
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="text-muted fst-italic">You have no products listed for sale.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

